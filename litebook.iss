; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!

[Setup]
; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={{C271CABE-D1DE-46B3-A92B-2CFD5DE732D5}
AppName=LiteBook v3
AppVerName=LiteBook v3.2
OutputBaseFilename=LiteBook_v3.2_Win_setup
AppPublisher=Hu Jun
AppPublisherURL=http://sites.google.com/site/litebooksite/
AppSupportURL=http://sites.google.com/site/litebooksite/
AppUpdatesURL=http://sites.google.com/site/litebooksite/
DefaultDirName={pf}\LiteBook
DefaultGroupName=LiteBook
DisableProgramGroupPage=yes
Compression=lzma
SolidCompression=yes

[Languages]
Name: "Chinese"; MessagesFile: "ChineseSimplified.isl"

[Tasks]
Name: "desktopicon"; Description: "{cm:CreateDesktopIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked
Name: "quicklaunchicon"; Description: "{cm:CreateQuickLaunchIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked

[Files]
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\litebook.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\python27.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\unrar.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\mainlist.txt"; DestDir: "{app}"; Flags: ignoreversion
;Source: "D:\hujun\litebook\tobuild\github\litebook\dist\l2_splash.gif"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\w9xpopen.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\litebook.exe.manifest"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\litebook.ico"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\jf.dat"; DestDir: "{app}"; Flags: ignoreversion
;Source: "D:\hujun\litebook\tobuild\github\litebook\dist\LiteBook_Readme.txt"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\defaultconfig.ini"; DestDir: "{app}"; Flags: ignoreversion
;Source: "D:\hujun\litebook\tobuild\github\litebook\dist\LiteBook_WhatsNew.txt"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\py.dat"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\bh.dat"; DestDir: "{app}"; Flags: ignoreversion
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\icon\*"; DestDir: "{app}\icon"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\kadp\*"; DestDir: "{app}\kadp"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\jieba\*"; DestDir: "{app}\jieba"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\lib\*"; DestDir: "{app}\lib"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\UnRAR2\*"; DestDir: "{app}\UnRAR2"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\helpdoc\*"; DestDir: "{app}\helpdoc"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\background\*"; DestDir: "{app}\background"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\plugin\*.py"; DestDir: "{app}\plugin"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "D:\hujun\litebook\tobuild\github\litebook\dist\templates\*"; DestDir: "{app}\templates"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "vcredist_x86.exe"; DestDir: "{tmp}"; Check: NeedInstallVC9SP1

[Icons]
Name: "{group}\LiteBook"; Filename: "{app}\litebook.exe";
Name: "{group}\LiteBook完全版"; Filename: "{app}\litebook.exe"; IconFilename: "{app}\litebook.exe"; Parameters: " -full";
Name: "{group}\恢复到缺省配置启动"; Filename: "{app}\litebook.exe"; IconFilename: "{app}\litebook.exe"; Parameters: " -reset";
Name: "{group}\{cm:UninstallProgram,LiteBook}"; Filename: "{uninstallexe}";
Name: "{commondesktop}\LiteBook"; Filename: "{app}\litebook.exe"; Tasks: desktopicon
Name: "{userappdata}\Microsoft\Internet Explorer\Quick Launch\LiteBook"; Filename: "{app}\litebook.exe"; Tasks: quicklaunchicon

[Run]
Filename: "{app}\litebook.exe"; Description: "{cm:LaunchProgram,LiteBook}"; Flags: nowait postinstall skipifsilent
Filename: "{tmp}\vcredist_x86.exe"; Parameters: /q; WorkingDir: {tmp}; Flags: skipifdoesntexist; StatusMsg: "Installing Microsoft Visual C++ Runtime ..."; Check: NeedInstallVC9SP1

[Registry]
;设置右键菜单项
Root: HKLM; Subkey: "Software\CLASSES\*\shell\用 LiteBook 阅读"; Flags: uninsdeletekey
Root: HKLM; Subkey: "Software\CLASSES\*\shell\用 LiteBook 阅读\command"; ValueType: String; ValueData: "{app}\litebook.exe %1"; Flags: uninsdeletekey


[Code]
var vc9SP1Missing: Boolean;

function NeedInstallVC9SP1(): Boolean;
begin
  Result := vc9SP1Missing;
end;

function InitializeSetup(): Boolean;
var version: Cardinal;
begin
  if RegQueryDWordValue(HKLM, 'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{9A25302D-30C0-39D9-BD6F-21E6EC160475}', 'Version', version) = false then begin
      if RegQueryDWordValue(HKLM, 'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{FF66E9F6-83E7-3A3E-AF14-8DE9A809A6A4}', 'Version', version) = false then begin
    vc9SP1Missing := true;
  end;
  end;
  result := true;
end;

